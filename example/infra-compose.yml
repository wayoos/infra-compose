version: '1'
environments:
  europe:
    - OS_REGION_NAME=EUR
  USEast:
    - OS_REGION_NAME=US-EAST

services:
  global:
    path: global
    commands:
      init: [terraform init]
      up: ['terraform apply', 'terraform version']
      down: [terraform destroy]        
  bastion:
    path: mgmt/services/bastion
    environments:
      - europe
    commands:
      init: [terraform init]
      up: [terraform apply]
      down: [terraform destroy -force]
      ssh: [script-ssh-connect.sh]

commands:
  init:
    - global init
    - bastion init
  up:
    - env=europe global up
    - env=USEast global up
    - bastion up
  down: [bastion down]
